# NER

## 实体识别

### LSTM

```
    "max_length": 50,
    "hidden_size": 768,
    "epoch": 10,
    "batch_size": 64,
    "optimizer": "adam",
    "learning_rate": 1e-3,
```

```
2024-03-16 13:43:27,494 - __main__ - INFO - --------------------
2024-03-16 13:43:27,495 - __main__ - INFO - epoch 10 begin
2024-03-16 13:43:27,520 - __main__ - INFO - batch loss 0.003543
2024-03-16 13:43:27,820 - __main__ - INFO - batch loss 0.003461
2024-03-16 13:43:28,104 - __main__ - INFO - batch loss 0.001649
2024-03-16 13:43:28,105 - __main__ - INFO - epoch average loss: 0.003668
2024-03-16 13:43:28,105 - __main__ - INFO - 开始测试第10轮模型效果：
2024-03-16 13:43:28,180 - __main__ - INFO - PERSON类实体，准确率：0.666667, 召回率: 0.439306, F1: 0.529612
2024-03-16 13:43:28,180 - __main__ - INFO - LOCATION类实体，准确率：0.727891, 召回率: 0.557292, F1: 0.631263
2024-03-16 13:43:28,180 - __main__ - INFO - TIME类实体，准确率：0.881890, 召回率: 0.687117, F1: 0.772409
2024-03-16 13:43:28,180 - __main__ - INFO - ORGANIZATION类实体，准确率：0.576271, 召回率: 0.400000, F1: 0.472217
2024-03-16 13:43:28,180 - __main__ - INFO - Macro-F1: 0.601375
2024-03-16 13:43:28,180 - __main__ - INFO - Micro-F1 0.620750
2024-03-16 13:43:28,180 - __main__ - INFO - --------------------
```

### LSTM+CRF

```
2024-03-16 13:40:58,928 - __main__ - INFO - epoch 10 begin
2024-03-16 13:40:59,006 - __main__ - INFO - batch loss 0.170837
2024-03-16 13:40:59,884 - __main__ - INFO - batch loss 0.133724
2024-03-16 13:41:00,744 - __main__ - INFO - batch loss 0.002655
2024-03-16 13:41:00,745 - __main__ - INFO - epoch average loss: 0.134061
2024-03-16 13:41:00,745 - __main__ - INFO - 开始测试第10轮模型效果：
2024-03-16 13:41:01,251 - __main__ - INFO - PERSON类实体，准确率：0.716667, 召回率: 0.497110, F1: 0.587026
2024-03-16 13:41:01,251 - __main__ - INFO - LOCATION类实体，准确率：0.705128, 召回率: 0.572917, F1: 0.632179
2024-03-16 13:41:01,251 - __main__ - INFO - TIME类实体，准确率：0.910569, 召回率: 0.687117, F1: 0.783212
2024-03-16 13:41:01,251 - __main__ - INFO - ORGANIZATION类实体，准确率：0.644068, 召回率: 0.447059, F1: 0.527773
2024-03-16 13:41:01,252 - __main__ - INFO - Macro-F1: 0.632547
2024-03-16 13:41:01,252 - __main__ - INFO - Micro-F1 0.646120
2024-03-16 13:41:01,252 - __main__ - INFO - --------------------
```

对比未加CRF来说，实验效果有提升

### BERT

```
2024-03-16 15:13:00,669 - __main__ - INFO - --------------------
2024-03-16 15:13:00,670 - __main__ - INFO - epoch 10 begin
2024-03-16 15:13:00,879 - __main__ - INFO - batch loss 0.420604
2024-03-16 15:13:05,442 - __main__ - INFO - batch loss 1.165826
2024-03-16 15:13:09,914 - __main__ - INFO - batch loss 2.861332
2024-03-16 15:13:09,914 - __main__ - INFO - epoch average loss: 0.586017
2024-03-16 15:13:09,914 - __main__ - INFO - 开始测试第10轮模型效果：
2024-03-16 15:13:10,949 - __main__ - INFO - PERSON类实体，准确率：0.000000, 召回率: 0.000000, F1: 0.000000
2024-03-16 15:13:10,950 - __main__ - INFO - LOCATION类实体，准确率：0.000000, 召回率: 0.000000, F1: 0.000000
2024-03-16 15:13:10,950 - __main__ - INFO - TIME类实体，准确率：0.000000, 召回率: 0.000000, F1: 0.000000
2024-03-16 15:13:10,950 - __main__ - INFO - ORGANIZATION类实体，准确率：0.000000, 召回率: 0.000000, F1: 0.000000
2024-03-16 15:13:10,950 - __main__ - INFO - Macro-F1: 0.000000
2024-03-16 15:13:10,950 - __main__ - INFO - Micro-F1 0.000000
2024-03-16 15:13:10,950 - __main__ - INFO - --------------------
```



效果很差，训练loss在下降，但是预测结果始终是零，尝试过很多办法，包括改lr,bs，冻结参数，加中间层都不起作用

推测是训练数据不足导致的，一共就12*128 = 1,536 条数据，可能对于bert来说数量太少了。**经过实验发现cls标记为-1，模型无法正常训练**

## 加标点

同样是用bert进行微调，进行”加标点“实验的效果就好很多，一轮就可以到0.771605

```
2024-03-16 14:40:18,122 - __main__ - INFO - gpu可以使用，迁移模型至gpu
2024-03-16 14:40:21,116 - __main__ - INFO - epoch 1 begin
2024-03-16 14:40:21,280 - __main__ - INFO - batch loss 1.529140
2024-03-16 14:41:38,485 - __main__ - INFO - batch loss 0.059100
2024-03-16 14:42:57,381 - __main__ - INFO - epoch average loss: 0.084168
2024-03-16 14:42:57,381 - __main__ - INFO - 开始测试第1轮模型效果：
2024-03-16 14:43:07,731 - __main__ - INFO - 符号预测准确率：0.995204
2024-03-16 14:43:07,732 - __main__ - INFO - 符号，预测准确率：0.755858
2024-03-16 14:43:07,732 - __main__ - INFO - 符号。预测准确率：0.709097
2024-03-16 14:43:07,732 - __main__ - INFO - 符号？预测准确率：0.626263
2024-03-16 14:43:07,733 - __main__ - INFO - 平均acc：0.771605
```

训练数据量是980*32 = 31,360条数据

对比lstm的加标点任务提升很明显,lstm6轮才到0.563918

```
2024-03-16 14:46:11,500 - __main__ - INFO - gpu可以使用，迁移模型至gpu
2024-03-16 14:46:14,200 - __main__ - INFO - epoch 1 begin
2024-03-16 14:46:14,545 - __main__ - INFO - batch loss 1.390051
2024-03-16 14:46:23,970 - __main__ - INFO - batch loss 0.171946
2024-03-16 14:46:33,362 - __main__ - INFO - epoch average loss: 0.146950
2024-03-16 14:46:33,362 - __main__ - INFO - 开始测试第1轮模型效果：
2024-03-16 14:46:34,906 - __main__ - INFO - 符号预测准确率：0.993380
2024-03-16 14:46:34,907 - __main__ - INFO - 符号，预测准确率：0.358818
2024-03-16 14:46:34,907 - __main__ - INFO - 符号。预测准确率：0.319186
2024-03-16 14:46:34,907 - __main__ - INFO - 符号？预测准确率：0.354369
2024-03-16 14:46:34,907 - __main__ - INFO - 平均acc：0.506438
2024-03-16 14:46:34,907 - __main__ - INFO - --------------------
2024-03-16 14:46:34,908 - __main__ - INFO - epoch 2 begin
2024-03-16 14:46:34,930 - __main__ - INFO - batch loss 0.095398
2024-03-16 14:46:44,431 - __main__ - INFO - batch loss 0.087690
2024-03-16 14:46:53,964 - __main__ - INFO - epoch average loss: 0.094649
2024-03-16 14:46:53,964 - __main__ - INFO - 开始测试第2轮模型效果：
2024-03-16 14:46:55,517 - __main__ - INFO - 符号预测准确率：0.989731
2024-03-16 14:46:55,517 - __main__ - INFO - 符号，预测准确率：0.475611
2024-03-16 14:46:55,518 - __main__ - INFO - 符号。预测准确率：0.343461
2024-03-16 14:46:55,518 - __main__ - INFO - 符号？预测准确率：0.417476
2024-03-16 14:46:55,518 - __main__ - INFO - 平均acc：0.556570
2024-03-16 14:46:55,519 - __main__ - INFO - --------------------
2024-03-16 14:46:55,519 - __main__ - INFO - epoch 3 begin
2024-03-16 14:46:55,540 - __main__ - INFO - batch loss 0.059325
2024-03-16 14:47:05,113 - __main__ - INFO - batch loss 0.055052
2024-03-16 14:47:14,659 - __main__ - INFO - epoch average loss: 0.058301
2024-03-16 14:47:14,659 - __main__ - INFO - 开始测试第3轮模型效果：
2024-03-16 14:47:16,210 - __main__ - INFO - 符号预测准确率：0.987391
2024-03-16 14:47:16,210 - __main__ - INFO - 符号，预测准确率：0.468545
2024-03-16 14:47:16,211 - __main__ - INFO - 符号。预测准确率：0.396711
2024-03-16 14:47:16,211 - __main__ - INFO - 符号？预测准确率：0.427184
2024-03-16 14:47:16,211 - __main__ - INFO - 平均acc：0.569958
2024-03-16 14:47:16,211 - __main__ - INFO - --------------------
2024-03-16 14:47:16,212 - __main__ - INFO - epoch 4 begin
2024-03-16 14:47:16,234 - __main__ - INFO - batch loss 0.040250
2024-03-16 14:47:25,789 - __main__ - INFO - batch loss 0.043632
2024-03-16 14:47:35,286 - __main__ - INFO - epoch average loss: 0.028214
2024-03-16 14:47:35,286 - __main__ - INFO - 开始测试第4轮模型效果：
2024-03-16 14:47:36,836 - __main__ - INFO - 符号预测准确率：0.986489
2024-03-16 14:47:36,837 - __main__ - INFO - 符号，预测准确率：0.469330
2024-03-16 14:47:36,837 - __main__ - INFO - 符号。预测准确率：0.402819
2024-03-16 14:47:36,837 - __main__ - INFO - 符号？预测准确率：0.378641
2024-03-16 14:47:36,838 - __main__ - INFO - 平均acc：0.559320
2024-03-16 14:47:36,838 - __main__ - INFO - --------------------
2024-03-16 14:47:36,839 - __main__ - INFO - epoch 5 begin
2024-03-16 14:47:36,860 - __main__ - INFO - batch loss 0.017577
2024-03-16 14:47:46,448 - __main__ - INFO - batch loss 0.013710
2024-03-16 14:47:55,966 - __main__ - INFO - epoch average loss: 0.015776
2024-03-16 14:47:55,967 - __main__ - INFO - 开始测试第5轮模型效果：
2024-03-16 14:47:57,524 - __main__ - INFO - 符号预测准确率：0.986314
2024-03-16 14:47:57,525 - __main__ - INFO - 符号，预测准确率：0.443419
2024-03-16 14:47:57,526 - __main__ - INFO - 符号。预测准确率：0.432733
2024-03-16 14:47:57,526 - __main__ - INFO - 符号？预测准确率：0.393204
2024-03-16 14:47:57,526 - __main__ - INFO - 平均acc：0.563918
```

